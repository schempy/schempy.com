<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="0f8jwWWg0SVBbRsXYkxmK1CKxgrnmm1VQ-MxRA84rcQ" />
  
  <title>Where To Have API Calls In React Flux | Recent Blog Posts By Brian Schemp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Working with React/Flux the last three months I couldn’t decide where to make asynchronous calls. Should they be made in the component, store or action creators? I chose the action creators since disp">
<meta property="og:type" content="article">
<meta property="og:title" content="Where To Have API Calls In React Flux">
<meta property="og:url" content="http://www.schempy.com/2015/03/02/where_to_have_api_calls_in_react_flux/index.html">
<meta property="og:site_name" content="Recent Blog Posts By Brian Schemp">
<meta property="og:description" content="Working with React/Flux the last three months I couldn’t decide where to make asynchronous calls. Should they be made in the component, store or action creators? I chose the action creators since disp">
<meta property="og:updated_time" content="2015-05-19T21:31:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Where To Have API Calls In React Flux">
<meta name="twitter:description" content="Working with React/Flux the last three months I couldn’t decide where to make asynchronous calls. Should they be made in the component, store or action creators? I chose the action creators since disp">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style-min.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59930748-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="https://www.github.com/schempy">GitHub</a>
        
          <a class="main-nav-link" href="https://www.twitter.com/schempy">Twitter</a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-where_to_have_api_calls_in_react_flux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/02/where_to_have_api_calls_in_react_flux/" class="article-date">
  <time datetime="2015-03-02T00:00:00.000Z" itemprop="datePublished">Mar 2nd 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Where To Have API Calls In React Flux
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Working with React/Flux the last three months I couldn’t decide where to make asynchronous calls. Should they be made in the component, store or action creators? I chose the action creators since dispatching of all actions come from them. A module could abstract the actual asynchronous call and return a promise.  The promise would resolve with the result of the call or be rejected if there was an error.</p>
<a id="more"></a>
<p>Here’s an example of the module to make the asynchronous call. I used <a href="https://github.com/visionmedia/superagent" target="_blank" rel="external">superagent</a> to make the request.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Api = &#123;</span><br><span class="line">	get: <span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">			request</span><br><span class="line">				.get(url)</span><br><span class="line">				.end(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">					<span class="keyword">if</span> (res.status === <span class="number">404</span>) &#123;</span><br><span class="line">						reject();</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						resolve(<span class="built_in">JSON</span>.parse(res.text));</span><br><span class="line">					&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The action creator would use this module. When the promise is returned dispatch an action containing the result. </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Api = <span class="built_in">require</span>(<span class="string">'./Api'</span>);</span><br><span class="line"><span class="keyword">var</span> Dispatcher = <span class="built_in">require</span>(<span class="string">'./Dispatcher'</span>);</span><br><span class="line"><span class="keyword">var</span> ActionConstants = <span class="built_in">require</span>(<span class="string">'./ActionConstants'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the ActionCreator.</span></span><br><span class="line"><span class="keyword">var</span> ActionCreator = &#123;</span><br><span class="line">	getCategories: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		Api</span><br><span class="line">			.get(<span class="string">'/api/categories'</span>)</span><br><span class="line">			.then(<span class="function"><span class="keyword">function</span> (<span class="params">categories</span>) </span>&#123;</span><br><span class="line">			</span><br><span class="line">				<span class="comment">// Dispatch an action containing the categories.</span></span><br><span class="line">				Dispatcher.handleViewAction(&#123;</span><br><span class="line">					actionType: ActionConstants.RECEIVE_CATEGORIES,</span><br><span class="line">					categories: categories</span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>The store would register with the dispatcher and provide a callback to handle the response from the action. It would also emit a change event so components would be notified that values have changed.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Dispatcher = <span class="built_in">require</span>(<span class="string">'./Dispatcher'</span>);</span><br><span class="line"><span class="keyword">var</span> ActionConstants = <span class="built_in">require</span>(<span class="string">'./ActionConstants'</span>);</span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"><span class="keyword">var</span> assign = <span class="built_in">require</span>(<span class="string">'object-assign'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> CHANGE_EVENT = <span class="string">'change'</span>;</span><br><span class="line"><span class="keyword">var</span> _categories = [];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setCategories</span> (<span class="params">categories</span>) </span>&#123;</span><br><span class="line">	_categories = categories;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the Store.</span></span><br><span class="line"><span class="keyword">var</span> Store = assign(&#123;&#125;, EventEmitter.prototype, &#123;</span><br><span class="line"></span><br><span class="line">	emitChange: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.emit(CHANGE_EVENT);</span><br><span class="line">	&#125;,</span><br><span class="line">	</span><br><span class="line">	addChangeListener: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.on(CHANGE_EVENT, callback);</span><br><span class="line">	&#125;,</span><br><span class="line">	</span><br><span class="line">	removeChangeListener: <span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.removeListener(CHANGE_EVENT, callback);</span><br><span class="line">	&#125;,</span><br><span class="line">	</span><br><span class="line">	getCategories: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> _categories;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Store registers with dispatcher to handle actions.</span></span><br><span class="line">Store.dispatchToken = Dispatcher.register(<span class="function"><span class="keyword">function</span> (<span class="params">payload</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> action = payload.action;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">switch</span> (action.actionType) &#123;</span><br><span class="line">		<span class="keyword">case</span> ActionConstants.RECEIVE_CATEGORIES:</span><br><span class="line">			</span><br><span class="line">			<span class="comment">// Callback to handle the response from the action.</span></span><br><span class="line">			setCategories();</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">			</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Store.emitChange();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Finally our components would use the store to register change listeners and the action creator for getting our categories!</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Store = <span class="built_in">require</span>(<span class="string">'./Store'</span>);</span><br><span class="line"><span class="keyword">var</span> ActionCreator = <span class="built_in">require</span>(<span class="string">'./ActionCreator'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define the Category component.</span></span><br><span class="line"><span class="keyword">var</span> Category = React.createClass(&#123;</span><br><span class="line"></span><br><span class="line">  getInitialState: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      categories: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  componentWillMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Store.addChangeListener(<span class="keyword">this</span>._onChange);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Use the ActionCreator to get the categories.</span></span><br><span class="line">  componentDidMount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    ActionCreator.getCategories();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  componentWillUnmount: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Store.removeChangeListener(<span class="keyword">this</span>._onChange);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span><br><span class="line">  * Update the state of categories for this component.</span><br><span class="line">  * This will get called when our store handles the response</span><br><span class="line">  * from the action.</span><br><span class="line">  */</span></span><br><span class="line">  _onChange: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      categories: Store.getCategories()</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Display a drop-down containg the categories.</span></span><br><span class="line">  render: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> categories;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.categories) &#123;</span><br><span class="line">      categories = <span class="keyword">this</span>.state.categories.map(<span class="function"><span class="keyword">function</span> (<span class="params">category</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="title">option</span> <span class="attribute">key</span>=<span class="value">&#123;</span> <span class="attribute">category.id</span> &#125;</span><br><span class="line">            <span class="attribute">value</span>=<span class="value">&#123;</span> <span class="attribute">category.name</span> &#125;&gt;</span></span><br><span class="line">            &#123; category.name &#125;<span class="tag">&lt;/<span class="title">option</span>&gt;</span>;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="title">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">select</span> <span class="attribute">name</span>=<span class="value">"category"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="title">option</span> <span class="attribute">value</span>=<span class="value">""</span>&gt;</span>Select a Category<span class="tag">&lt;/<span class="title">option</span>&gt;</span></span><br><span class="line">          &#123; categories &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span>  </span><br><span class="line">    )</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="final_thoughts">final thoughts</h2><p>The result from an asynchronous call should create an action. This keeps the data flowing through the application the flux way (Actions -&gt; Dispatcher -&gt; Stores -&gt; Views).</p>
<p>One issue having the category component make a Api call once it’s mounted is it will be rendered twice. Having components get their data from props is better but sometimes the data has to be from an external service.</p>
<p>Check out the repo on github: <a href="https://github.com/schempy/react-flux-api-calls" target="_blank" rel="external">react-flux-api-calls</a></p>
<p>Questions? Comments? Tweet me <a href="https://www.twitter.com/schempy" target="_blank" rel="external">@schempy</a> or email <a href="mailto:schempysays@gmail.com" target="_blank" rel="external">schempysays@gmail.com</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.schempy.com/2015/03/02/where_to_have_api_calls_in_react_flux/" data-id="ciaip0pq500017xm6nhgqp18m" class="article-share-link">Tweet This</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/03/11/streaming_file_uploads_with_nodejs/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Streaming File Uploads With Node.js
        
      </div>
    </a>
  
  
    <a href="/2015/02/16/reactjs_flux_and_routing_for_seo/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">React Flux and Routing For Seo</div>
    </a>
  
</nav>

  
</article>
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/05/find_stored_procedure_dependencies/">Find Stored Procedure Dependencies</a>
          </li>
        
          <li>
            <a href="/2016/01/19/angular2_webpack_typescript/">Angular2 With Typescript And Webpack</a>
          </li>
        
          <li>
            <a href="/2015/11/24/asp_net_dropdownlist_control_datasource/">Asp.net Dropdownlist Control Datasource Expression</a>
          </li>
        
          <li>
            <a href="/2015/10/14/simple_async_with_rxjs/">Simple Async With RxJS</a>
          </li>
        
          <li>
            <a href="/2015/09/17/docker_nodejs_using_host_volumes/">Node.js and Docker Using Host Volumes</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Schempy<br>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/script-min.js" type="text/javascript"></script>
  </div>
</body>
</html>