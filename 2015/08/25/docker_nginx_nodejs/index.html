<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="0f8jwWWg0SVBbRsXYkxmK1CKxgrnmm1VQ-MxRA84rcQ" />
  
  <title>Nginx and Node.js with Docker | Recent Blog Posts By Brian Schemp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx and Node.js with Docker">
<meta property="og:url" content="http://www.schempy.com/2015/08/25/docker_nginx_nodejs/index.html">
<meta property="og:site_name" content="Recent Blog Posts By Brian Schemp">
<meta property="og:description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
<meta property="og:updated_time" content="2015-09-18T00:23:35.092Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx and Node.js with Docker">
<meta name="twitter:description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style-min.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59930748-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="https://www.github.com/schempy">GitHub</a>
        
          <a class="main-nav-link" href="https://www.twitter.com/schempy">Twitter</a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-docker_nginx_nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/25/docker_nginx_nodejs/" class="article-date">
  <time datetime="2015-08-25T00:00:00.000Z" itemprop="datePublished">Aug 25th 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nginx and Node.js with Docker
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using the <a href="https://hub.docker.com/r/library/nginx/" target="_blank" rel="external">official image from Docker</a>. For Nodejs, I’ll be creating a custom Docker image.</p>
<p>Full source code for this example <a href="https://github.com/schempy/docker-nginx-node-part1" target="_blank" rel="external">docker-nginx-node-part1</a></p>
<a id="more"></a>
<h3 id="Directory_Structure">Directory Structure</h3><p>Here is the directory setup I’ll be using:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nodejs/</span><br><span class="line">	Dockerfile</span><br><span class="line">	src/</span><br><span class="line">		package.json</span><br><span class="line">		server.js</span><br><span class="line">web/</span><br><span class="line">	src/</span><br><span class="line">		public/</span><br><span class="line">			index.html</span><br><span class="line">config/</span><br><span class="line">	nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>The <strong>nodejs</strong> directory contains a Dockerfile to create a Docker image and a src directory that stores the nodejs server javascript file and package.json file.</p>
<p>The <strong>web</strong> directory contains the static web files used by the Nginx web server.<br>The <strong>config</strong> directory contains the custom Nginx configuration file I’ll be using for creating the Nginx Docker container.</p>
<h3 id="The_Nginx_Docker_Image">The Nginx Docker Image</h3><p>I need to pull the latest Nginx image from DockerHub. Execute the following bash command to do just that:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure></p>
<p>The Nginx image uses <a href="https://hub.docker.com/_/debian/" target="_blank" rel="external">Debian</a> as the base OS. I’ll be using that for creating the custom Nodejs Docker image. </p>
<h3 id="The_Nodejs_Docker_Image">The Nodejs Docker Image</h3><p>Create a file named <strong>Dockerfile</strong> in  the <strong>nodejs</strong> directory with the following:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM debian</span><br><span class="line"></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y \</span><br><span class="line">	curl \</span><br><span class="line">	python \</span><br><span class="line">	make \</span><br><span class="line">	g++</span><br><span class="line"></span><br><span class="line">RUN curl <span class="operator">-s</span>L https://deb.nodesource.com/setup_0.<span class="number">12</span> | bash -</span><br><span class="line">RUN apt-get update &amp;&amp; apt-get install -y \</span><br><span class="line">	nodejs</span><br><span class="line"></span><br><span class="line">COPY ./src /var/www/api</span><br><span class="line"></span><br><span class="line">RUN <span class="built_in">cd</span> /var/www/api; npm install</span><br><span class="line"></span><br><span class="line">EXPOSE <span class="number">5000</span></span><br><span class="line">CMD [<span class="string">"node"</span>, <span class="string">"/var/www/api/server.js"</span>]</span><br></pre></td></tr></table></figure></p>
<p>The Dockerfile will do the following:</p>
<ul>
<li>Lines  3-7 installs libraries that will be necessary for building node modules.</li>
<li>Lines 9-11 installs the latest Node.js and npm versions.</li>
<li>Line 13 copies the source code inside the Docker image.</li>
<li>Line 15 installs the dependencies from npm.</li>
<li>The node.js server will run on port 5000 so we expose that port on line 17.</li>
<li>Line  18 defines the command to run which will use the node runtime followed by the path to our node.js server.</li>
</ul>
<p>To build the Docker Nodejs image execute this bash command from the <strong>nodejs</strong> directory:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t /example/nodejs .</span><br></pre></td></tr></table></figure></p>
<p>To confirm we have the necessary Docker images execute the following bash command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure></p>
<p>You should see entries for <strong>example/nodejs</strong>, <strong>nginx</strong> and <strong>debian</strong> under the repository heading. </p>
<p>Now that we have Docker images we’ll use them to build our Docker containers.</p>
<h3 id="The_Nodejs_Docker_Container">The Nodejs Docker Container</h3><p>To create a Nodejs Docker container execute the following bash command from the project root directory:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">	<span class="operator">-d</span> \</span><br><span class="line">	--name <span class="string">"nodejs"</span> \</span><br><span class="line">	-p <span class="number">5000</span>:<span class="number">5000</span> \</span><br><span class="line">	example/nodejs;</span><br></pre></td></tr></table></figure></p>
<p>Docker will do the following after executing the bash command above:</p>
<ul>
<li>Line 2 instructs Docker to run the container in the background.</li>
<li>Line 3 instructs Docker to name the container <strong>nodejs</strong>. We’ll be using the name of this container within the nginx configuration.</li>
<li>Line 4 instructs Docker to map the Docker host (port 5000) to the Docker container (port 5000).</li>
<li>Line 5 instructs Docker to use the NodeJs Docker image, example/nodejs, we previously created.</li>
</ul>
<p>To ensure the Nodejs Docker container is running goto <a href="http://localhost:5000/api" target="_blank" rel="external">http://localhost:5000/api</a> in your web browser. You should see a page that displays ‘Hello World’. You can also execute the following bash command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></p>
<p>You’ll see the running container with the name <strong>nodejs</strong>.</p>
<h3 id="The_Nginx_Docker_Container">The Nginx Docker Container</h3><p>I’ll be using a custom <strong>nginx.conf</strong> file that will be mapped to the containers <strong>/etc/nginx</strong> directory. Here is the server portion which defines the proxy to the node.js server.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        index index.html;</span><br><span class="line">        server_name localhost;</span><br><span class="line">        error_<span class="built_in">log</span>  /var/<span class="built_in">log</span>/nginx/error.log;</span><br><span class="line">        access_<span class="built_in">log</span> /var/<span class="built_in">log</span>/nginx/access.log;</span><br><span class="line">        root /var/www/public;</span><br><span class="line"></span><br><span class="line">        location ~* /api &#123;</span><br><span class="line">            proxy_pass http://nodejs:<span class="number">5000</span>;</span><br><span class="line">            proxy_http_version <span class="number">1.1</span>;</span><br><span class="line">            proxy_<span class="built_in">set</span>_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">            proxy_<span class="built_in">set</span>_header Connection <span class="string">'upgrade'</span>;</span><br><span class="line">            proxy_<span class="built_in">set</span>_header Host <span class="variable">$host</span>;</span><br><span class="line">            proxy_cache_bypass <span class="variable">$http_upgrade</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>The configuration will proxy any requests to the url <strong>/api</strong> to the Nodejs Docker container! Note the <strong>proxy_pass</strong> entry, lines 9-16, uses the name of the Nodejs Docker container, nodejs, that was created.</p>
<p>To create the Nginx container execute the following bash command from the project root directory:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">	<span class="operator">-d</span>  \</span><br><span class="line">	--name <span class="string">"web"</span> \</span><br><span class="line">	-p <span class="number">8080</span>:<span class="number">80</span> \</span><br><span class="line">	-v $(<span class="built_in">pwd</span>)/web/src:/var/www \</span><br><span class="line">	-v $(<span class="built_in">pwd</span>)/config/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">	--link nodejs:nodejs \</span><br><span class="line">	nginx;</span><br></pre></td></tr></table></figure></p>
<p>Docker will do the following after executing the bash command above:</p>
<ul>
<li>Line 2 instructs Docker to run the container in the background.</li>
<li>Line 3 instructs Docker to name the container <strong>web</strong>.</li>
<li>Line 4 instructs Docker to map the Docker host (port 8080) to the Docker container (port 80).</li>
<li>Line 5 instructs Docker to map our local <strong>web/src</strong> directory to the Docker Nginx containers <strong>/var/www</strong> directory.</li>
<li>Line 6 instructs Docker to map  our local Nginx configuration file into the containers <strong>/etc/nginx</strong> directory.</li>
<li>Line 7 instructs Docker to reference the Nodejs Docker container, named <strong>nodejs</strong>, from the Nginx Docker container. This will create a entry in the /etc/hosts/ file to the Nginx Docker container.</li>
</ul>
<p>Confirm the Nginx Docker container is running by executing the following bash command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></p>
<p>You should see a running container with the name <strong>web</strong>.</p>
<p>Point your browser to <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a>. Click on the link labled API and that will take you to the nodejs server! Notice the link does not contain the port 5000. This is because Nginx is configured to use the /api url as a proxy to the nodejs server.</p>
<p>Full source code for this example <a href="https://github.com/schempy/docker-nginx-node-part1" target="_blank" rel="external">docker-nginx-node-part1</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.schempy.com/2015/08/25/docker_nginx_nodejs/" data-id="cidrt18km000013powlx2r1vf" class="article-share-link">Tweet This</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/09/17/docker_nodejs_using_host_volumes/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Node.js and Docker Using Host Volumes
        
      </div>
    </a>
  
  
    <a href="/2015/06/04/react_with_react_engine/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">React with react-engine</div>
    </a>
  
</nav>

  
</article>
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/05/find_stored_procedure_dependencies/">Find Stored Procedure Dependencies</a>
          </li>
        
          <li>
            <a href="/2016/01/19/angular2_webpack_typescript/">Angular2 With Typescript And Webpack</a>
          </li>
        
          <li>
            <a href="/2015/11/24/asp_net_dropdownlist_control_datasource/">Asp.net Dropdownlist Control Datasource Expression</a>
          </li>
        
          <li>
            <a href="/2015/10/14/simple_async_with_rxjs/">Simple Async With RxJS</a>
          </li>
        
          <li>
            <a href="/2015/09/17/docker_nodejs_using_host_volumes/">Node.js and Docker Using Host Volumes</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Schempy<br>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/script-min.js" type="text/javascript"></script>
  </div>
</body>
</html>