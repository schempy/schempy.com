<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="google-site-verification" content="0f8jwWWg0SVBbRsXYkxmK1CKxgrnmm1VQ-MxRA84rcQ" />
  
  <title>Nginx and Node.js with Docker | Recent Blog Posts By Brian Schemp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx and Node.js with Docker">
<meta property="og:url" content="http://www.schempy.com/2015/08/25/docker_nginx_nodejs/index.html">
<meta property="og:site_name" content="Recent Blog Posts By Brian Schemp">
<meta property="og:description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
<meta property="og:updated_time" content="2015-08-26T00:59:44.636Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx and Node.js with Docker">
<meta name="twitter:description" content="I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using t">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style-min.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-59930748-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="https://www.github.com/schempy">GitHub</a>
        
          <a class="main-nav-link" href="https://www.twitter.com/schempy">Twitter</a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-docker_nginx_nodejs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/08/25/docker_nginx_nodejs/" class="article-date">
  <time datetime="2015-08-25T00:00:00.000Z" itemprop="datePublished">Aug 25th 2015</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nginx and Node.js with Docker
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ll be using Docker to create a Nginx web server and a Nodejs server. Nginx will be configured to use the Nodejs server as a proxy to a specfic url (/api for this example). For Nginx, I’ll be using the <a href="https://hub.docker.com/r/library/nginx/" target="_blank" rel="external">official image from Docker</a>. For Nodejs, I’ll be creating a custom Docker image.</p>
<p>Full source code for this example <a href="https://github.com/schempy/docker-nginx-node-part1" target="_blank" rel="external">docker-nginx-node-part1</a></p>
<a id="more"></a>
<h3 id="Directory_Structure">Directory Structure</h3><p>Here is the directory setup I’ll be using:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nodejs/</span><br><span class="line">	Dockerfile</span><br><span class="line">	src/</span><br><span class="line">		package.json</span><br><span class="line">		server.js</span><br><span class="line">web/</span><br><span class="line">	src/</span><br><span class="line">		public/</span><br><span class="line">			index.html</span><br><span class="line">config/</span><br><span class="line">	nginx.conf</span><br></pre></td></tr></table></figure></p>
<p>The <strong>nodejs</strong> directory contains a Dockerfile to create a Docker image and a src directory that stores the nodejs server javascript file and package.json file.</p>
<p>The <strong>web</strong> directory contains the static web files used by the Nginx web server.<br>The <strong>config</strong> directory contains the custom Nginx configuration file I’ll be using for creating the Nginx Docker container.</p>
<h3 id="The_Nginx_Docker_Image">The Nginx Docker Image</h3><p>I need to pull the latest Nginx image from DockerHub. Execute the following bash command to do just that:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx:latest</span><br></pre></td></tr></table></figure></p>
<p>The Nginx image uses <a href="https://hub.docker.com/_/debian/" target="_blank" rel="external">Debian</a> as the base OS. I’ll be using that for creating the custom Nodejs Docker image. </p>
<h3 id="The_Nodejs_Docker_Image">The Nodejs Docker Image</h3><p>Create a file named <strong>Dockerfile</strong> in  the <strong>nodejs</strong> directory with the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM debian&#10;&#10;RUN apt-get update &#38;&#38; apt-get install -y \&#10;&#9;curl \&#10;&#9;python \&#10;&#9;make \&#10;&#9;g++&#10;&#10;RUN curl -sL https://deb.nodesource.com/setup_0.12 | bash -&#10;RUN apt-get update &#38;&#38; apt-get install -y \&#10;&#9;nodejs&#10;&#10;COPY ./src /var/www/api&#10;&#10;RUN cd /var/www/api; npm install&#10;&#10;EXPOSE 5000&#10;CMD [&#34;node&#34;, &#34;/var/www/api/server.js&#34;]</span><br></pre></td></tr></table></figure></p>
<p>The Dockerfile will do the following:</p>
<ul>
<li>Install some libraries that will be necessary for building node modules.</li>
<li>Install the latest Node.js and npm versions.</li>
<li>Copy the source code inside the Docker image.</li>
<li>Install the dependencies from npm.</li>
<li>The node.js server will run on port 5000 so we expose that port.</li>
<li>Define the command to run which will use the node runtime followed by the path to our node.js server.</li>
</ul>
<p>To build the Docker Nodejs image execute this bash command from the <strong>nodejs</strong> directory:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t /example/nodejs .</span><br></pre></td></tr></table></figure></p>
<p>To confirm we have the necessary Docker images execute the following bash command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure></p>
<p>You should see entries for <strong>example/nodejs</strong>, <strong>nginx</strong> and <strong>debian</strong> under the repository heading. </p>
<p>Now that we have Docker images we’ll use them to build our Docker containers.</p>
<h3 id="The_Nodejs_Docker_Container">The Nodejs Docker Container</h3><p>To create a Nodejs Docker container execute the following bash command from the project root directory:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run \&#10;&#9;-d \&#10;&#9;--name &#34;nodejs&#34; \&#10;&#9;-p 5000:5000 \&#10;&#9;example/nodejs;</span><br></pre></td></tr></table></figure></p>
<p>Docker will do the following after executing the bash command above:</p>
<ul>
<li><strong>d</strong> tells Docker to run the container in the background.</li>
<li><strong>name</strong> tells Docker to name the container <strong>nodejs</strong>. We’ll be using the name of this container within the nginx configuration.</li>
<li><strong>p</strong> tells Docker to map the Docker host (port 5000) to the Docker container (port 5000).</li>
<li>Use the NodeJs Docker image, example/nodejs, we previously created.</li>
</ul>
<p>To ensure the Nodejs Docker container is running goto <a href="http://localhost:5000/api" target="_blank" rel="external">http://localhost:5000/api</a> in your web browser. You should see a page that displays ‘Hello World’. You can also execute the following bash command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></p>
<p>You’ll see the running container with the name <strong>nodejs</strong>.</p>
<h3 id="The_Nginx_Docker_Container">The Nginx Docker Container</h3><p>I’ll be using a custom <strong>nginx.conf</strong> file that will be mapped to the containers <strong>/etc/nginx</strong> directory. Here is the server portion which defines the proxy to the node.js server.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">    server &#123;&#10;        listen 80;&#10;        index index.html;&#10;        server_name localhost;&#10;        error_log  /var/log/nginx/error.log;&#10;        access_log /var/log/nginx/access.log;&#10;        root /var/www/public;&#10;&#10;        location ~* /api &#123;&#10;            proxy_pass http://nodejs:5000;&#10;            proxy_http_version 1.1;&#10;            proxy_set_header Upgrade $http_upgrade;&#10;            proxy_set_header Connection &#39;upgrade&#39;;&#10;            proxy_set_header Host $host;&#10;            proxy_cache_bypass $http_upgrade;&#10;        &#125;&#10;    &#125;&#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>The configuration will proxy any requests to the url <strong>/api</strong> to the Nodejs Docker container! Note the <strong>proxy_pass</strong> entry uses the name of the Nodejs Docker container, nodejs, that was created.</p>
<p>To create the Nginx container execute the following bash command from the project root directory:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run \&#10;&#9;-d  \&#10;&#9;--name &#34;web&#34; \&#10;&#9;-p 8080:80 \&#10;&#9;-v $(pwd)/web/src:/var/www \&#10;&#9;-v $(pwd)/config/nginx.conf:/etc/nginx/nginx.conf \&#10;&#9;--link nodejs:nodejs \&#10;&#9;nginx;</span><br></pre></td></tr></table></figure></p>
<p>Docker will do the following after executing the bash command above:</p>
<ul>
<li><strong>d</strong> tells Docker to run the container in the background.</li>
<li><strong>name</strong> tells Docker to name the container <strong>web</strong>.</li>
<li><strong>p</strong> tells Docker to map the Docker host (port 8080) to the Docker container (port 80).</li>
<li><strong>v</strong> tells Docker to map our local <strong>web/src</strong> directory to the Docker Nginx containers <strong>/var/www</strong> directory.</li>
<li><strong>v</strong> tells Docker to map  our local Nginx configuration file into the containers <strong>/etc/nginx</strong> directory.</li>
<li><strong>link</strong> tells Docker to reference the Nodejs Docker container, named <strong>nodejs</strong>, from the Nginx Docker container. This will create a entry in the /etc/hosts/ file to the Nginx Docker container.</li>
</ul>
<p>Confirm the Nginx Docker container is running by executing the following bash command:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure></p>
<p>You should see a running container with the name <strong>web</strong>.</p>
<p>Point your browser to <a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a>. Click on the link labled API and that will take you to the nodejs server! Notice the link does not contain the port 5000. This is because Nginx is configured to use the /api url as a proxy to the nodejs server.</p>
<p>Full source code for this example <a href="https://github.com/schempy/docker-nginx-node-part1" target="_blank" rel="external">docker-nginx-node-part1</a></p>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://www.schempy.com/2015/08/25/docker_nginx_nodejs/" data-id="cidrt18km000013powlx2r1vf" class="article-share-link">Tweet This</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2015/06/04/react_with_react_engine/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">React with react-engine</div>
    </a>
  
</nav>

  
</article>
</section>
        
          <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/08/25/docker_nginx_nodejs/">Nginx and Node.js with Docker</a>
          </li>
        
          <li>
            <a href="/2015/06/04/react_with_react_engine/">React with react-engine</a>
          </li>
        
          <li>
            <a href="/2015/05/20/source_maps_with_nodejs/">Source Maps With Node.js</a>
          </li>
        
          <li>
            <a href="/2015/04/03/responsive_layout_with_stylus_jeet_and_rupture/">Responsive Layouts With Stylus Jeet And Rupture</a>
          </li>
        
          <li>
            <a href="/2015/03/24/async_tasks_with_es6_generators/">Async Tasks With ES6 Generators</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Schempy<br>
    </div>
  </div>
</footer>
    </div>
    

<script src="/js/script-min.js" type="text/javascript"></script>
  </div>
</body>
</html>